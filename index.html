<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>MoonX</title>
  <style>
    :root {
      --bg-color: #f2f2f2;
      --text-color: #000000;
      --input-bg: #ffffff;
      --btn-bg: #dddddd;
      --btn-active: #4c4cff;
    }

    body.dark {
      --bg-color: #121212;
      --text-color: #ffffff;
      --input-bg: #1e1e1e;
      --btn-bg: #333333;
      --btn-active: #4c4cff;
    }

    body {
      margin: 0;
      background: var(--bg-color);
      color: var(--text-color);
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      transition: background 0.3s, color 0.3s;
    }

    .logo {
      font-size: 60px;
      font-weight: bold;
      color: var(--btn-active);
      text-shadow: 0 0 10px #bfcfff;
      margin-bottom: 30px;
    }

    .search-container {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .search-box {
      display: flex;
      border: 1px solid #ccc;
      border-radius: 30px;
      padding: 10px 20px;
      width: 400px;
      background: var(--input-bg);
    }

    .search-box input {
      flex: 1;
      border: none;
      font-size: 18px;
      outline: none;
      background: transparent;
      color: var(--text-color);
    }

    .search-box button {
      background: none;
      border: none;
      cursor: pointer;
      font-size: 18px;
      color: var(--text-color);
    }

    .engine-select {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .engine-select button {
      padding: 8px 16px;
      border: none;
      border-radius: 10px;
      background: var(--btn-bg);
      cursor: pointer;
      color: var(--text-color);
      transition: background 0.3s;
    }

    .engine-select button.active {
      background: var(--btn-active);
      color: white;
    }

    .theme-toggle, .voice-toggle {
      position: absolute;
      top: 20px;
      padding: 8px 16px;
      border: none;
      border-radius: 20px;
      cursor: pointer;
      color: var(--text-color);
      background: var(--btn-bg);
    }

    .theme-toggle {
      right: 20px;
    }

    .voice-toggle {
      right: 100px;
    }
    .user-panel {
      position: absolute;
      top: 20px;
      left: 20px;
    }
    #user-info {
      display: flex;
      align-items: center;
      gap: 10px;
    } 
    #user-info img {
      width: 32px;
      height: 32px;
      border-radius: 50%;
    }
   .menu {
      position: absolute;
      background: var(--btn-bg);
      border-radius: 10px;
      top: 40px;
      left: 0;
      display: flex;
      flex-direction: column;
      padding: 5px;
      z-index: 100;
    }
   .menu button {
      background: none;
      border: none;
      color: var(--text-color);
      padding: 5px 10px;
      text-align: left;
      cursor: pointer;
    }
   .menu button:hover {
      background: #66666644;
    }
   .hidden {
      display: none;
    }
   .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #00000088;
      display: flex;
      justify-content: center;
      align-items: center;
    }
   .modal-content {
      background: var(--input-bg);
      padding: 20px;
      border-radius: 10px;
      color: var(--text-color);
      box-shadow: 0 0 10px #000;
    }     
    .bookmarks {
      margin-top: 40px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .bookmarks button {
      padding: 8px 14px;
      border: none;
      border-radius: 10px;
      background: var(--btn-bg);
      color: var(--text-color);
      cursor: pointer;
    }
  </style>
  <!-- –°–∫—Ä–∏–ø—Ç Google Identity -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>
  <button class="theme-toggle" onclick="toggleTheme()">üåô</button>
  <button class="voice-toggle" onclick="startVoice()">üé§</button>
  <div class="logo">MoonX</div>
  <div class="search-container">
    <form id="search-form" class="search-box" target="_blank">
      <input type="text" id="search-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å..." />
      <button type="submit">üîç</button>
    </form>
    <div class="engine-select">
      <button onclick="setEngine('yandex')">Yandex</button>
      <button onclick="setEngine('google')">Google</button>
    </div>
  </div>

  <div class="bookmarks" id="bookmarks"></div>
  
  <script>
    let currentEngine = localStorage.getItem('engine') || 'yandex';
    let darkMode = localStorage.getItem('theme') === 'dark';

    function applySettings() {
      if (darkMode) document.body.classList.add('dark');
      else document.body.classList.remove('dark');

      const engineButtons = document.querySelectorAll('.engine-select button');
      engineButtons.forEach(btn => btn.classList.remove('active'));
      if (currentEngine === 'yandex') engineButtons[0].classList.add('active');
      else engineButtons[1].classList.add('active');

      document.querySelector('.theme-toggle').textContent = darkMode ? 'üåû' : 'üåô';
    }

    function toggleTheme() {
      darkMode = !darkMode;
      localStorage.setItem('theme', darkMode ? 'dark' : 'light');
      applySettings();
    }

    function setEngine(engine) {
      currentEngine = engine;
      localStorage.setItem('engine', engine);
      applySettings();
    }

    document.getElementById('search-form').addEventListener('submit', function (e) {
      e.preventDefault();
      const query = document.getElementById('search-input').value.trim();
      if (!query) return;

      let url = '';
      if (currentEngine === 'yandex') {
        url = 'https://yandex.ru/search/?text=' + encodeURIComponent(query);
      } else {
        url = 'https://www.google.com/search?q=' + encodeURIComponent(query);
      }
      window.open(url, '_blank');
    });

    // üé§ –ì–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥
    function startVoice() {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!SpeechRecognition) return alert('–ë—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≥–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥');

      const recognition = new SpeechRecognition();
      recognition.lang = 'ru-RU';
      recognition.interimResults = false;
      recognition.maxAlternatives = 1;

      recognition.start();

      recognition.onresult = function (event) {
        const result = event.results[0][0].transcript;
        document.getElementById('search-input').value = result;
      };

      recognition.onerror = function (event) {
        alert('–û—à–∏–±–∫–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è: ' + event.error);
      };
    }

    // ‚≠ê –ë—ã—Å—Ç—Ä—ã–µ –∑–∞–∫–ª–∞–¥–∫–∏
    const defaultBookmarks = [
      { name: 'YouTube', url: 'https://youtube.com' },
      { name: 'Wikipedia', url: 'https://ru.wikipedia.org' },
      { name: 'GitHub', url: 'https://github.com' },
      { name: 'ChatGPT', url: 'https://chat.openai.com' }
    ];

    function renderBookmarks() {
      const container = document.getElementById('bookmarks');
      container.innerHTML = '';
      defaultBookmarks.forEach(bookmark => {
        const btn = document.createElement('button');
        btn.textContent = bookmark.name;
        btn.onclick = () => window.open(bookmark.url, '_blank');
        container.appendChild(btn);
      });
    }          
    
    // Google OAuth –û–±—Ä–∞–±–æ—Ç–∫–∞
    function handleCredentialResponse(response) {
      const data = parseJwt(response.credential);
      const name = data.name;
      const email = data.email;
      const picture = data.picture;
      
      // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
      localStorage.setItem("user_name", name);
      localStorage.setItem("user_email", email);
      localStorage.setItem("user_picture", picture);
      
      // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º
      renderGoogleUser();
    }
    
    function parseJwt(token) {
      const base64Url = token.split('.')[1];
      const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
      const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
        return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
      }).join(''));
      return JSON.parse(jsonPayload);
    }

    function renderGoogleUser() {
      const name = localStorage.getItem("user_name");
      const email = localStorage.getItem("user_email");
      const picture = localStorage.getItem("user_picture");
    
      if (name && email) {
        document.querySelector(".g_id_signin").style.display = "none";
        
        const userPanel = document.createElement("div");
        userPanel.style.position = "absolute";
        userPanel.style.top = "20px";
        userPanel.style.right = "20px";
        userPanel.style.background = "var(--input-bg)";
        userPanel.style.padding = "10px";
        userPanel.style.borderRadius = "12px";
        userPanel.style.boxShadow = "0 0 10px rgba(0,0,0,0.2)";
        userPanel.style.textAlign = "center";
        
        userPanel.innerHTML = `
          <img src="${picture}" alt="avatar" style="width:48px;height:48px;border-radius:50%;"><br>
          <strong>${name}</strong><br>
          <small>${email}</small><br>
          <button onclick="logoutGoogle()" style="margin-top:8px;padding:4px 10px;border-radius:6px;border:none;background:#f66;color:white;cursor:pointer;">–í—ã–π—Ç–∏</button>
        `;

        document.body.appendChild(userPanel);
      }
    }
      
    function logoutGoogle() {
      localStorage.removeItem("user_name");
      localStorage.removeItem("user_email");
      localStorage.removeItem("user_picture");
      location.reload();
    }
     
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º, –µ—Å–ª–∏ —É–∂–µ –≤—Ö–æ–¥–∏–ª —Ä–∞–Ω–µ–µ
    renderGoogleUser();
      
    // –ü—Ä–∏–º–µ–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ –æ—Ç—Ä–∏—Å–æ–≤–∞—Ç—å –≤—Å—ë
    applySettings();
    renderBookmarks();
  </script>

  <!-- Google –í—Ö–æ–¥ -->
  <div id="g_id_onload"
       data-client_id="617555845778-kfgn7cnrc7sdc4stme1as1tfiu3bod8f.apps.googleusercontent.com"
       data-callback="handleCredentialResponse"
       data-auto_prompt="false">
  </div>
  
  <div style="position:absolute; top:20px; right:20px; z-index:999;">
    <div class="g_id_signin"
         data-type="standard"
         data-size="medium"
         data-theme="outline"
         data-text="sign_in_with"
         data-shape="circle"
         data-logo_alignment="center">
    </div>
  </div>

</body>
</html>
